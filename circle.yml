machine:
  pre:
  # Upgrade docker
    - curl -sSL https://s3.amazonaws.com/circle-downloads/install-circleci-docker.sh | bash -s -- 1.10.0
  services:
    - docker

dependencies:
  pre:
    - sudo pip install --upgrade docker-compose
  override:
    - docker build -t notary-dev .

test:
  pre:
    - docker-compose -f docker-compose.yml up -d

  override:
    - docker run --rm notary-dev make vet lint fmt test
    - docker run --rm --link notary_server_1:notary-server notary-dev buildscripts/testclient.sh

  post:
    - docker-compose -f docker-compose.yml down
    - docker rmi -f notary-dev
